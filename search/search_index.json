{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"About","text":""},{"location":"#about","title":"About","text":""},{"location":"#what-is-the-api","title":"What is the API?","text":"<p>Sonardyne's API is designed to use off-the-shelf technologies for interfacing to Sonardyne instruments and systems. This software does not collect, process, or store any personal data.</p> <p>A typical integration will involve using a combination of:  </p> <ul> <li>Web User Interface</li> <li>API</li> <li>Input and Output messages</li> </ul> <p>Information on these pages will assist a developer or integrator by providing integration examples, suggested tooling, and all required reference documentation. </p>"},{"location":"#which-products-use-the-api","title":"Which products use the API?","text":"<p>The below Sonardyne products support the Sonardyne API:</p> System/Instrument Version SPRINT-Nav Mini 1.2.607 Future Support <p>Future Sonardyne products will utilise a common version of this API</p>"},{"location":"#primary-interface-grpc-and-protobuf-vs-secondary-interface-json","title":"Primary interface (gRPC and Protobuf) vs Secondary interface (JSON)","text":"<p>The gRPC interface is in a binary format, and will use fewer bytes to send each command which saves bandwidth and reduces processing time/latency on the instrument. The JSON interface is a layer added to the gRPC interface to allow sending and receiving of JSON string representations of Protocol Buffers. See the Technology Explainer for more details.</p>"},{"location":"external_reference/","title":"External Reference","text":""},{"location":"external_reference/#external-references","title":"External References","text":"<p>The below references are useful for development, but are in no way affiliated with Sonardyne.</p>"},{"location":"external_reference/#awesome-grpc","title":"Awesome gRPC","text":"<p>awesome-grpc is a list of resources for gRPC development.</p>"},{"location":"external_reference/#grpc-ui","title":"gRPC UI","text":"<p>gRPC UI is a command-line tool that lets you interact with gRPC servers via a browser. The resulting UI allows the user to interactively construct requests to send to a gRPC server, by presenting all of the fields in a tree view. It uses the MIT License.</p> Example use of gRPC UI <p>To perform a GetState, select \"GetState\" from the \"Method name\" dropdown and click \"Invoke\" (leaving the other fields blank). Response from the GetState: To perform a SetState, select \"SetState\" from the \"Method name\" dropdown and add the necessary fields using the tree view below. Response from the SetState: </p> <p>To install gRPC UI, go to the gRPC UI GitHub releases page and download the latest release (e.g. grpcui_1.3.1_windows_x86_64.zip). Extract the zip to a location from which you can run the executable (e.g. C:/tools/grpcui/). Open a command/terminal window in the same directory as grpcui.exe, and run the following command: <code>grpcui.exe -plaintext -import-path ./protos -proto service.proto 192.168.179.10:8000</code> Note that in this example, the <code>.proto</code> files are located in a <code>protos</code> folder at the same level as <code>grpcui.exe</code></p>"},{"location":"integration/","title":"Integration Examples","text":""},{"location":"integration/#sprint-nav-mini","title":"Sprint-Nav Mini","text":"<p>SPRINT-Nav Mini is designed to be easily integrated into multiple classes of vehicle/vessel. All available inputs and outputs, as well as detailed integration documents, are described in the product manual. This section provides a broad overview of how to integrate a SPRINT-Nav Mini on a vehicle/vessel.</p>"},{"location":"integration/#physical-installation","title":"Physical installation","text":"<p>SPRINT-Nav Mini can be installed at any convenient location where the DVL has an unobstructed view of the seabed. However, to gain optimal performance there are some guidelines. </p> <p>CAD .stp files are available on Sonardyne's knowledge base</p> Installation Guidelines <ul> <li>The location must not be subject to excessive vibration or impulse shock.  </li> <li>The location must not exceed the environmental limits for the temperature.  </li> <li>The location must provide a mounting surface that is of sufficient strength to support the weight of the SPRINT-Nav Mini safely and without flexing.  </li> <li>The location must provide access for power and communication connections.  </li> <li>The location must provide line of sight to the seabed for all four DVL transducers abiding by the clearance levels. </li> </ul>"},{"location":"integration/#time","title":"Time","text":"<p>The SPRINT-Nav Mini can be time synchronised to UTC. This can be achieved via NTP or by providing a 1PPS signal and ZDA NMEA-0183 message from a GPS receiver or similar clock source. </p> <p>If the serial communication link has a known, stable latency then it is possible to use ZDA only, but 1PPS is recommended where possible. If the SPRINT-Nav Mini has been time synchronised and its quality is less than or equal to 0.5s it is possible to stop providing ZDA messages and simply rely on 1PPS aiding without any loss of accuracy.</p> <p>To improve robustness and usability, the SPRINT-Nav Mini incorporates a feature that automatically detects the relationship between the ZDA and 1PPS without any configuration. The SPRINT-Nav Mini achieves this by treating ZDA and 1PPS aiding separately: by filtering over several ZDA and 1PPS observations, it alleviates the requirement for a user to configure the ZDA and 1PPS relationship. In addition, the SPRINT-Nav Mini automatically detects the leading edge of the 1PPS trigger (assuming the pulse width is much less than 0.5s).  If external time synchronisation is lost the INS can continue to maintain an estimate of UTC time using its internal clock (~5ppm drift).</p> <p>The ZDA message should conform to the NMEA 0183 standard. The message can be received on any channel or over Ethernet. The 1PPS signal should be a 5V DC pulse with &gt;1 \u00b5s duration. The signal can be fed to SPRINT-Nav Mini via any of the trigger channels. </p> <p>There are three modes available:  </p> <ul> <li>None </li> <li>ZDA (+1PPS)</li> <li>NTP</li> </ul> <p>Time can also be output by a SPRINT-Nav Mini via an output ZDA + 1PPS, typically used for time synchronising other onboard survey sensors. </p>"},{"location":"integration/#sound-velocity","title":"Sound Velocity","text":"<p>Accurate knowledge of Sound Velocity is crucial for Hybrid (DVL/INS) navigation, as such SPRINT-Nav Mini supports three types of SV. It is recommended to always use external SV for operations requiring high navigation accuracy. </p> <ul> <li>Manual<ul> <li>Provides an ability to type in a Manual SV, to be used when SV is very stable or as a backup. </li> </ul> </li> <li>Derived<ul> <li>Uses water temperature and a manually entered salinity value to calculate SV.</li> </ul> </li> <li>External <ul> <li>Uses an external SV sensor to input a direct read Sound Velocity into the SPRINT-Nav Mini.</li> </ul> </li> </ul> <p></p> Notes on SV <ul> <li>Sonardyne find that a 25mm SV sensor provides enough accuracy for navigation and minimises risk of damage to the SV sensor.</li> <li>Place the SV sensor as close to the DVL as possible.</li> <li>Place the SV Sensor within the same body of water as the DVL.</li> <li>Any error in SV will often appear as an along track error if no external aiding source is provided i.e. GNSS or USBL.    </li> </ul>"},{"location":"integration/#dvl-mounting","title":"DVL mounting","text":"<p>SPRINT-Nav Mini can be mounted at any angle, however typically the DVL is mounted facing directly down on the vehicle providing the best tracking of the seabed. Occasionally on trenchers or other vehicles where a direct view of the seabed is not possible, the DVL may be installed at an angle. </p> <p></p>"},{"location":"integration/#position-aiding","title":"Position aiding","text":""},{"location":"integration/#usbl","title":"USBL","text":"<p>SPRINT-Nav Mini supports USBL aiding via industry-standard telegrams. </p>"},{"location":"integration/#gnss","title":"GNSS","text":"<p>SPRINT-Nav Mini uses GNSS for aiding of both time and position via industry-standard telegrams.</p>"},{"location":"integration/#xpos","title":"XPOS","text":"<p>SPRINT-Nav Mini supports Sonardyne's proprietary XPOS message for aiding of generic position observations. Typically an XPOS message is provided to a SPRINT-Nav Mini when a vehicle is docked, initialising on deck or any scenario whereby a GNSS or USBL message is not appropriate. </p>"},{"location":"integration/#auv-x-sprint-nav-mini","title":"AUV x SPRINT-Nav Mini","text":"<p>SPRINT-Nav Mini has been designed for AUV integration and this section will describe an example integration into a 10\" AUV, with a common setup with a mix of input, output, C2 (Command &amp; Control) and peripheral survey sensors. </p> Inputs <ul> <li>GNSS</li> <li>USBL</li> <li>Sound Velocity </li> </ul> Outputs <ul> <li>HNAV</li> <li>ZDA + 1PPS</li> </ul> C2 <ul> <li>gRPC API</li> </ul> Survey Sensors <ul> <li>Voyis Recon - Laser</li> <li>Voyis Recon - Camera</li> </ul> <p></p>"},{"location":"integration/#mounting-location","title":"Mounting location","text":"<p>In this example the SPRINT-Nav Mini is mounted in the free flooded nose cone of a Sparus. The DVL has a clear view of the seabed with no obstructed beams. </p> <p></p>"},{"location":"integration/#aiding-sensors","title":"Aiding sensors","text":"<p>SPRINT-Nav Mini can have multiple aiding sensors enabled at once so it will seamlessly use GNSS on surface and USBL when it becomes available subsea. </p>"},{"location":"integration/#gnss_1","title":"GNSS","text":"<p>When on the surface the AUV receives both positioning updates (GGA) and timing (ZDA + 1PPS) from the onboard GNSS which is mounted on a mast at the rear of the vehicle. </p> GNSS aiding on an AUV <ul> <li>When configuring a GNSS in SPRINT-Nav Mini, consider that GNSS accuracy estimates are often optimistic. Sonardyne recommend setting a relaxed manual GNSS quality.</li> <li>GNSS often gives erroneous positions as a vehicle surfaces and when a vehicle dives. SPRINT-Nav Mini will reject data that falls outside its own position error estimate, however why not consider disabling GNSS when diving and for a period of time after breaking the surface. </li> <li>SPRINT-Nav Mini doesn't currently use VTG for velocity aiding, but will in the future. </li> </ul>"},{"location":"integration/#usbl_1","title":"USBL","text":"<p>When submerged, the AUV utilises Sonardyne's Mini Ranger 2 Robotics Pack to track an AvTrak 6 Nano mounted in the AUV. This AvTrak 6 Nano is used for communicating with the surface and also for sending position updates into the SPRINT-Nav Mini. </p> USBL Aiding a SPRINT-Nav Mini on an AUV <ul> <li>All AvTrak 6 nano's, when being tracked by \"Robotics Pack\", can output a time-stamped GGA message directly from their serial port in addition to the native SPOS format which can be interfaced directly to the SPRINT-Nav Mini. See the AvTrak 6 Nano manual for more details. </li> <li>Ranger 2 Robotics Pack can track up to 10 vehicles at once, simultaneously sending them correct absolute position information as well as exchanging telemetry. </li> </ul>"},{"location":"integration/#sound-velocity_1","title":"Sound Velocity","text":"<p>For sound velocity a Valeport 25mm SVS is used, outputting the valeport standard telegram into the vehicle control system and then over UDP into the SPRINT-Nav Mini.  </p>"},{"location":"integration/#outputs","title":"Outputs","text":""},{"location":"integration/#hnav","title":"HNAV","text":"<p>HNAV is output at 100Hz for vehicle guidance purposes. All status flags are decoded and presented in the AUV Web UI so that the operator knows when it is ok for the vehicle to begin operations. Certain flags from the HNAV are decoded which will cause vehicle behaviours. Please see Reference for further details.</p> HNAV Notes <ul> <li>If an output message is populated at a rate quicker than the rate of the incoming sensor the HNAV status field will reflect invalid (because the flag indicates invalid or old). For example in a 100Hz output HNAV message, if DVL is coming into the SPRINT-Nav Mini at 10Hz, in excess of 90% of messages would be expected to have an invalid altitude flag. </li> <li>HNAV can be input directly into EIVA Naviscan in a traditional survey setup. </li> </ul>"},{"location":"integration/#timing","title":"Timing","text":"<p>Timing is crucial for survey deliverables as all sensors which are logging data must log against a common time base. This is typically UTC. SPRINT-Nav Mini can be configured to both receive time updates and will also persist time when subsea.</p> <p>In this example a ZDA + 1PPS output is configured from the SPRINT-Nav Mini into all survey sensors on the AUV. </p> ZDA + 1PPS output <ul> <li>Outputting a ZDA + 1PPS doesn't mean that time won't drift when the vehicle is subsea, but all sensors will be in the same time base. </li> <li>SPRINT-Nav Mini constantly models and monitors time, as such when the AUV surfaces and GNSS timing is available once again, SPRINT-Nav Mini's UTC time will adjust to reflect the correct UTC time. </li> </ul>"},{"location":"integration/#c2","title":"C2","text":"<p>Command and Control of a SPRINT-Nav Mini uses the Sonardyne gRPC API to modify settings dynamically during a mission as and when required, either autonomously or via the user-developed AUV interface. </p> Suggested SPRINT-Nav Mini C2 <ul> <li>Via the user-developed AUV interface the AUV operator can reset the INS algorithm instantaneously if required.</li> <li>If the vehicle/operator knows that GNSS is erroneous it can be disabled as an aiding source for a period of time. </li> <li>If the SPRINT-Nav HNAV message flags a problem with the Sound Velocity sensor, the C2 changes the SV configuration to derived and then manual. </li> <li>The user-developed AUV interface allows a user to select which aiding sources should be used by the AUV pre-dive without using the SPRINT-Nav Mini user interface.</li> <li>The gRPC API is much lower bandwidth than the web UI allowing for over the horizon low bandwidth operations. </li> </ul>"},{"location":"integration/#data","title":"Data","text":"<p>For high accuracy survey products, [Janus] (https://www.sonardyne.com/products/janus-ins-post-processing-software/) is commonly used. In this example logfiles are downloaded at the end of the mission via the web UI. </p> Data for long duration AUVs <ul> <li>SPRINT-Nav Mini will log data internally for 2 to 3 days. Less if raw DVL data is logged. </li> <li>For long duration missions the vehicle control system can periodically download logfiles from the unit via SFTP. </li> </ul>"},{"location":"integration/#auv-lessons-learnt","title":"AUV lessons learnt","text":"<p>Sonardyne's applications engineering team have integrated SPRINT-Nav Mini into many different vehicles and have collated some best practice.  </p> Lessons learned <ul> <li>Consider the orientation of DVL beams, if following a pipeline is there a better orientation to keep all DVL beams facing the seabed?</li> <li>If HNAV indicates that SV is no longer valid, why not switch back to derived, or manual?</li> </ul>"},{"location":"license/","title":"License","text":""},{"location":"license/#third-party-licenses","title":"Third-Party licenses","text":""},{"location":"license/#grpc","title":"gRPC","text":"<p>gRPC and its documentation is licensed under Apache 2.0.</p>"},{"location":"license/#json","title":"JSON","text":"<p>JSON is licensed under a modified MIT license.</p>"},{"location":"license/#mkdocs","title":"MkDocs","text":"<p>MkDocs is licensed under BSD.</p>"},{"location":"license/#protoc-gen-doc","title":"protoc-gen-doc","text":"<p>protoc-gen-doc is licensed under MIT.</p>"},{"location":"license/#sonardyne","title":"Sonardyne","text":"<p>All example code and documentation is licensed under MIT.</p>"},{"location":"protocol_reference/","title":"Protocol Reference","text":"<p>The below reference is automatically generated from the proto files, therefore some fields are blank.</p>"},{"location":"protocol_reference/#protocol-documentation","title":"Protocol Documentation","text":""},{"location":"protocol_reference/#table-of-contents","title":"Table of Contents","text":"<ul> <li> <p>configuration.proto</p> <ul> <li>AidingConfiguration</li> <li>Configuration</li> <li>ConfigurationEnvelope</li> <li>ConfigurationRequest</li> <li>DopplerVelocityLogConfiguration</li> <li>ResetConfiguration</li> <li> <p>SoundVelocityConfiguration</p> </li> <li> <p>AidingConfiguration.AIDING_STATE</p> </li> <li>DopplerVelocityLogConfiguration.UPDATE_RATE</li> <li>ResetConfiguration.RESET_TYPE</li> <li>SoundVelocityConfiguration.SOUND_VELOCITY</li> </ul> </li> <li> <p>result.proto</p> <ul> <li> <p>Result</p> </li> <li> <p>Result.Outcome</p> </li> </ul> </li> <li> <p>service.proto</p> <ul> <li>SonardyneService</li> </ul> </li> <li> <p>timestamp.proto</p> <ul> <li>Timestamp</li> </ul> </li> <li> <p>uid.proto</p> <ul> <li>Uid</li> </ul> </li> <li> <p>version.proto</p> <ul> <li>VersionRequest</li> <li>VersionResponse</li> </ul> </li> <li> <p>Scalar Value Types</p> </li> </ul> <p></p> <p>Top</p>"},{"location":"protocol_reference/#configurationproto","title":"configuration.proto","text":""},{"location":"protocol_reference/#aidingconfiguration","title":"AidingConfiguration","text":"<p>Position aiding configuration, defines which position input(s) to use for aiding</p> Field Type Label Description id Uid Used to identify recipient instrument/module result Result Populated by instrument when replying to a SetState enable_gnss AidingConfiguration.AIDING_STATE Used to turn GNSS aiding on or off enable_xpos AidingConfiguration.AIDING_STATE Used to turn XPOS aiding on or off enable_usbl AidingConfiguration.AIDING_STATE Used to turn USBL aiding on or off <p></p>"},{"location":"protocol_reference/#configuration","title":"Configuration","text":"<p>Each type of configuration is repeated to allow multiple recipients per message, e.g. resetting multiple algorithms on an instrument</p> Field Type Label Description reset_configurations ResetConfiguration repeated Collection of reset configurations aiding_configurations AidingConfiguration repeated Collection of aiding configurations sound_velocity_configurations SoundVelocityConfiguration repeated Collection of Sound Velocity configurations doppler_velocity_configurations DopplerVelocityLogConfiguration repeated Collection of Doppler Velocity configurations <p></p>"},{"location":"protocol_reference/#configurationenvelope","title":"ConfigurationEnvelope","text":"<p>A container of an instrument configuration and timestamp</p> Field Type Label Description timestamp Timestamp result Result Populated by instrument when replying to a SetState configuration Configuration <p></p>"},{"location":"protocol_reference/#configurationrequest","title":"ConfigurationRequest","text":"Field Type Label Description timestamp Timestamp requestor string Optional user-definable field"},{"location":"protocol_reference/#dopplervelocitylogconfiguration","title":"DopplerVelocityLogConfiguration","text":"<p>Doppler Velocity Log configuration which controls the update rate</p> Field Type Label Description id Uid Used to identify recipient instrument/module result Result Populated by instrument when replying to a SetState update_rate DopplerVelocityLogConfiguration.UPDATE_RATE Specifies the update rate in Hz <p></p>"},{"location":"protocol_reference/#resetconfiguration","title":"ResetConfiguration","text":"<p>Set type of reset to execute</p> Field Type Label Description id Uid Used to identify recipient instrument/module result Result Populated by instrument when replying to a SetState reset_type ResetConfiguration.RESET_TYPE Indicates the type of reset required <p></p>"},{"location":"protocol_reference/#soundvelocityconfiguration","title":"SoundVelocityConfiguration","text":"<p>Sound Velocity configuration which controls the type of trigger to use</p> Field Type Label Description id Uid Used to identify recipient instrument/module result Result Populated by instrument when replying to a SetState sound_velocity_type SoundVelocityConfiguration.SOUND_VELOCITY Define the Sound Velocity source manual_salinity_value double Used if Sound Velocity type is INTERNAL_SALINITY manual_velocity_value double Used if Sound Velocity type is INTERNAL_MANUAL <p></p>"},{"location":"protocol_reference/#aidingconfigurationaiding_state","title":"AidingConfiguration.AIDING_STATE","text":"Name Number Description AIDING_STATE_UNSPECIFIED 0 Default value if field is not populated ENABLED 1 DISABLED 2"},{"location":"protocol_reference/#dopplervelocitylogconfigurationupdate_rate","title":"DopplerVelocityLogConfiguration.UPDATE_RATE","text":"Name Number Description UPDATE_RATE_UNSPECIFIED 0 Default value if field is not populated TRIGGER_RISING 1 Use external trigger (rising edge) TRIGGER_FALLING 2 Use external trigger (falling edge) MAX_RATE 3 Use max supported update rate FIXED_1HZ 4 Use fixed 1Hz rate FIXED_2HZ 5 Use fixed 2Hz rate FIXED_5HZ 6 Use fixed 5Hz rate FIXED_10HZ 7 Use fixed 10Hz rate"},{"location":"protocol_reference/#resetconfigurationreset_type","title":"ResetConfiguration.RESET_TYPE","text":"Name Number Description RESET_TYPE_UNSPECIFIED 0 Default value if field is not populated SOFT_RESET 1 See instrument manual for description HARD_RESET 2 See instrument manual for description"},{"location":"protocol_reference/#soundvelocityconfigurationsound_velocity","title":"SoundVelocityConfiguration.SOUND_VELOCITY","text":"Name Number Description SOUND_VELOCITY_UNSPECIFIED 0 Default value if field is not populated EXTERNAL 1 Use external - N.B. The port must be specified in the webUI INTERNAL_SALINITY 2 Use internal (derived from salinity) INTERNAL_MANUAL 3 Use manually defined value <p>Top</p>"},{"location":"protocol_reference/#resultproto","title":"result.proto","text":""},{"location":"protocol_reference/#result","title":"Result","text":"Field Type Label Description success Result.Outcome Indicates success or failure. True for success, otherwise False message string Description of the operations result"},{"location":"protocol_reference/#resultoutcome","title":"Result.Outcome","text":"Name Number Description SUCCESS 0 Operation has succeeded FAILURE 1 Operation has failed INVALID 2 Operation has been given invalid parameters <p>Top</p>"},{"location":"protocol_reference/#serviceproto","title":"service.proto","text":""},{"location":"protocol_reference/#sonardyneservice","title":"SonardyneService","text":"Method Name Request Type Response Type Description GetVersion VersionRequest VersionResponse Gets the api protocol version SetState ConfigurationEnvelope ConfigurationEnvelope Sets instrument configuration. Returns the updated configuration, result, and timestamp GetState ConfigurationRequest ConfigurationEnvelope Gets instrument configuration. The 'ConfigurationRequest' contains required instrument specific configuration type StateStream ConfigurationRequest ConfigurationEnvelope stream A stream which publishes all state changes on the instrument. <p>Top</p>"},{"location":"protocol_reference/#timestampproto","title":"timestamp.proto","text":""},{"location":"protocol_reference/#timestamp","title":"Timestamp","text":"Field Type Label Description common_time double Time since the UNIX epoch (01/01/1970) in seconds and fractional seconds instrument_time double Monotonically increasing instrument time in seconds and fractional seconds <p>Top</p>"},{"location":"protocol_reference/#uidproto","title":"uid.proto","text":""},{"location":"protocol_reference/#uid","title":"Uid","text":"<p>Used to identify a recipient</p> Field Type Label Description uid uint32 Unique identifier of a recipient name string Human-readable recipient name populated in reply <p></p> <p>Top</p>"},{"location":"protocol_reference/#versionproto","title":"version.proto","text":""},{"location":"protocol_reference/#versionrequest","title":"VersionRequest","text":""},{"location":"protocol_reference/#versionresponse","title":"VersionResponse","text":"<p>A message that contains Semantic Versioning which comprises a three part version number: Major.Minor.Patch</p> Field Type Label Description Major uint32 MAJOR version incremented for incompatible changes that break existing clients. Minor uint32 MINOR version incremented for backward-compatible features or enhancements. Patch uint32 PATCH version incremented for backward-compatible bug fixes or patches."},{"location":"protocol_reference/#scalar-value-types","title":"Scalar Value Types","text":".proto Type Notes C++ Java Python Go C# PHP Ruby  double double double float float64 double float Float  float float float float float32 float float Float  int32 Uses variable-length encoding. Inefficient for encoding negative numbers \u2013 if your field is likely to have negative values, use sint32 instead. int32 int int int32 int integer Bignum or Fixnum (as required)  int64 Uses variable-length encoding. Inefficient for encoding negative numbers \u2013 if your field is likely to have negative values, use sint64 instead. int64 long int/long int64 long integer/string Bignum  uint32 Uses variable-length encoding. uint32 int int/long uint32 uint integer Bignum or Fixnum (as required)  uint64 Uses variable-length encoding. uint64 long int/long uint64 ulong integer/string Bignum or Fixnum (as required)  sint32 Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s. int32 int int int32 int integer Bignum or Fixnum (as required)  sint64 Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s. int64 long int/long int64 long integer/string Bignum  fixed32 Always four bytes. More efficient than uint32 if values are often greater than 2^28. uint32 int int uint32 uint integer Bignum or Fixnum (as required)  fixed64 Always eight bytes. More efficient than uint64 if values are often greater than 2^56. uint64 long int/long uint64 ulong integer/string Bignum  sfixed32 Always four bytes. int32 int int int32 int integer Bignum or Fixnum (as required)  sfixed64 Always eight bytes. int64 long int/long int64 long integer/string Bignum  bool bool boolean boolean bool bool boolean TrueClass/FalseClass  string A string must always contain UTF-8 encoded or 7-bit ASCII text. string String str/unicode string string string String (UTF-8)  bytes May contain any arbitrary sequence of bytes. string ByteString str []byte ByteString string String (ASCII-8BIT)"},{"location":"quick-start/","title":"Quick Start","text":""},{"location":"quick-start/#choice-of-technology","title":"Choice of Technology","text":"<p>See Technology Explainer for more information on the two available API choices for Command and Control. gRPC and JSON will both support control of Sonardyne instruments listed here. However, gRPC is a more expandable interface which will be extended to include real-time data and more configuration options, so is recommended for most integrations. </p>"},{"location":"quick-start/#connecting-to-the-api","title":"Connecting to the API","text":""},{"location":"quick-start/#configuring-grpc-or-json-via-web-ui","title":"Configuring gRPC or JSON via Web UI","text":"<p>The 'External Control' page in the webUI (located under Configuration&gt;System&gt;Connections) allows selection of a gRPC or JSON interface. The JSON interface operates via any of the ports specified under the 'Network' tab, whereas the gRPC interface operates a TCP server on the port number specified in the webUI.</p> Network Ports <p>Please note there is currently no cross-validation between the gRPC server and the other Network ports, you must ensure that the gRPC port number is not already in use in the Network tab.</p> <p>Example screenshot from SPRINT-Nav Mini Web UI </p>"},{"location":"quick-start/#accessing-proto-files","title":"Accessing .proto files","text":"<p>The .proto files which define the API will be needed before messages can be sent or received via gRPC. These files can be downloaded from the Releases page of the son-idl repo. They can also be found in the <code>idl</code> folder of this repo, alongside an explanation of all fields, provided by the <code>README.md</code> in the <code>idl</code> folder.</p>"},{"location":"quick-start/#sending-initial-commands","title":"Sending initial commands","text":"<p>The API implements three functions:</p> <ul> <li>GetVersion will return the API version number</li> <li>GetState will return the settings of the instrument</li> <li>SetState will update the instrument settings</li> </ul>"},{"location":"quick-start/#developmentdebugging-tools","title":"Development/Debugging Tools","text":"<p>See external reference.</p>"},{"location":"quick-start/#development-of-a-grpc-client","title":"Development of a gRPC client","text":""},{"location":"quick-start/#python-example","title":"Python Example","text":"<p>These steps are largely based on the grpc Python tutorial.</p> <ul> <li>Install gRPC and gRPC tools (protoc and code generation): <code>python -m pip install grpcio grpcio-tools</code></li> <li>Download .proto files and put them in a <code>protos</code> directory in your python project.</li> <li>Generate python code from the .protos: <code>python -m grpc_tools.protoc --proto_path=./protos --python_out=. --grpc_python_out=.  ./protos/*.proto</code></li> </ul> <p>This will generate a few files - as a grpc client we are primarily interested in importing service_pb2_grpc, which will allow us to use GetState, SetState, and GetVersion.</p> Example python code example_code/py/GrpcClient.py<pre><code>#Copyright 2023 Sonardyne\n\n#Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n#documentation files (the \u201cSoftware\u201d), to deal in the Software without restriction, including without limitation the\n#rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n#permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n#The above copyright notice and this permission notice shall be included in all copies or substantial portions of the\n#Software.\n\n#THE SOFTWARE IS PROVIDED \u201cAS IS\u201d, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\n#WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n#COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n#OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nimport grpc\nimport service_pb2_grpc\nimport version_pb2\nimport configuration_pb2\n\ndef SetExampleState(stub):\n    # Create a device configuration. This contains configurations for Reset, Aiding, Sound Velocity, and DVL\n    config = configuration_pb2.Configuration()\n\n    # Each type of configuration is stored as a list. This is reserved for future use as not all units support multiple configurations.\n\n    # Create and add a reset config to perform a soft reset\n    reset_config = configuration_pb2.ResetConfiguration(reset_type=\"SOFT_RESET\")\n    config.reset_configurations.append(reset_config)\n\n    # Create and add an aiding config to enable GNSS aiding and disable USBL aiding\n    aiding_config_enable_gnss = configuration_pb2.AidingConfiguration(enable_gnss=\"ENABLED\", enable_usbl=\"DISABLED\")\n    config.aiding_configurations.append(aiding_config_enable_gnss)\n\n    # Create and add a sound velocity config to set the SV source to salinity-derived and set the SV salinity to an arbitrary value\n    sv_config_salinity_derived = configuration_pb2.SoundVelocityConfiguration(sound_velocity_type=\"INTERNAL_SALINITY\", manual_salinity_value=32.1)\n    config.sound_velocity_configurations.append(sv_config_salinity_derived)\n\n    # Create and add a DVL config to set the update rate to an arbitrary choice\n    dvl_config_1Hz = configuration_pb2.DopplerVelocityLogConfiguration(update_rate=\"FIXED_1HZ\")\n    config.doppler_velocity_configurations.append(dvl_config_1Hz)\n\n    # Create the envelope containing the new config.\n    #  Envelopes also contain 'timestamp' and 'result' fields which are populated in the instrument reply.\n    config_envelope = configuration_pb2.ConfigurationEnvelope(configuration=config)\n\n    # Perform the SetState with the new envelope\n    result_envelope = stub.SetState(config_envelope)\n\n    # Returned envelope contains the current state of the updated settings, as well as a result field\n    print(\"Received ConfigurationEnvelope reply:\\n{}\".format(result_envelope))\n\n\nwith grpc.insecure_channel('127.0.0.1:1234') as channel: # NOTE: Change the IP Address and Port to match the Instrument and its gRPC configuration.\n    stub = service_pb2_grpc.SonardyneServiceStub(channel)\n\n    # Get the version number of the API\n    version_result = stub.GetVersion(version_pb2.VersionRequest())\n    print(\"Called GetVersion: v{}.{}\".format(version_result.Major, version_result.Minor))\n\n    # Get the current state of the instrument\n    result_config_envelope = stub.GetState(configuration_pb2.ConfigurationRequest(requestor=\"PyGrpcClient\"))\n    print(\"Called GetState:\\n{}\".format(result_config_envelope))\n    # For example, get the current GNSS aiding state\n    result_config = result_config_envelope.configuration\n    result_aiding_configuration = result_config.aiding_configurations[0]\n    result_gnss_aiding_state = result_aiding_configuration.enable_gnss\n    print(\"GNSS aiding state: {}\".format(result_gnss_aiding_state))\n\n    # Set an example state\n    SetExampleState(stub)\n</code></pre>"},{"location":"quick-start/#c-example","title":"C# Example","text":"<p>The recommended implementation for gRPC with .NET is now grpc-dotnet. Microsoft provide a tutorial on its use.</p> <p>The .csproj file needs to be modified to include the proto files and proto directory,  and to specify the project as a gRPC client, e.g. <code>&lt;Protobuf Include=\"service.proto\" ProtoRoot=\"protos/\" GrpcServices=\"Client\"/&gt;</code> Note that a wildcard <code>*</code> can be used e.g. <code>Include=\"*.proto\"</code>, however this was found to cause problems with certain ProtoRoot directories and be less clear when debugging.</p> Example C# code example_code/cs/SonGrpcClient.csproj<pre><code>&lt;Project Sdk=\"Microsoft.NET.Sdk\"&gt;\n\n  &lt;PropertyGroup&gt;\n    &lt;OutputType&gt;Exe&lt;/OutputType&gt;\n    &lt;TargetFramework&gt;net6.0&lt;/TargetFramework&gt;\n    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;\n    &lt;Nullable&gt;enable&lt;/Nullable&gt;\n  &lt;/PropertyGroup&gt;\n\n  &lt;ItemGroup&gt;\n    &lt;PackageReference Include=\"Google.Protobuf\" Version=\"3.24.0\" /&gt;\n    &lt;PackageReference Include=\"Grpc.Net.client\" Version=\"2.55.0\" /&gt;\n    &lt;PackageReference Include=\"Grpc.Tools\" Version=\"2.57.0\"&gt;\n      &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;\n      &lt;IncludeAssets&gt;runtime; build; native; contentfiles; analyzers; buildtransitive&lt;/IncludeAssets&gt;\n    &lt;/PackageReference&gt;\n\n    &lt;Protobuf Include=\"configuration.proto\" ProtoRoot=\"../../idl/\" GrpcServices=\"Client\"/&gt;\n    &lt;Protobuf Include=\"result.proto\" ProtoRoot=\"../../idl/\" GrpcServices=\"Client\"/&gt;\n    &lt;Protobuf Include=\"service.proto\" ProtoRoot=\"../../idl/\" GrpcServices=\"Client\"/&gt;\n    &lt;Protobuf Include=\"timestamp.proto\" ProtoRoot=\"../../idl/\" GrpcServices=\"Client\"/&gt;\n    &lt;Protobuf Include=\"uid.proto\" ProtoRoot=\"../../idl/\" GrpcServices=\"Client\"/&gt;\n    &lt;Protobuf Include=\"version.proto\" ProtoRoot=\"../../idl/\" GrpcServices=\"Client\"/&gt;\n  &lt;/ItemGroup&gt;\n\n&lt;/Project&gt;\n</code></pre> example_code/cs/Program.cs<pre><code>//Copyright 2023 Sonardyne\n\n//Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//documentation files (the \u201cSoftware\u201d), to deal in the Software without restriction, including without limitation the\n//rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n//permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n//The above copyright notice and this permission notice shall be included in all copies or substantial portions of the\n//Software.\n\n//THE SOFTWARE IS PROVIDED \u201cAS IS\u201d, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\n//WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n//COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n//OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nusing Grpc.Net.Client;\nusing SonardyneApi;\n\nGrpcChannel channel = GrpcChannel.ForAddress(\"http://127.0.0.1:1234\"); // NOTE: Change the IP Address and Port to match the Instrument and its gRPC configuration.\nSonardyneService.SonardyneServiceClient client = new SonardyneService.SonardyneServiceClient(channel);\n\n// Get the version number of the API\nvar getVersionReply = client.GetVersion(new VersionRequest());\nConsole.WriteLine($\"\\nCalled GetVersion: v.{getVersionReply.Major}.{getVersionReply.Minor}\");\n\n// Get the current state of the instrument\nvar getStateReply = client.GetState(new ConfigurationRequest());\nConsole.WriteLine(\"\\nCalled GetState:\\n\" + getStateReply.Configuration.ToString());\n\nif (getStateReply.Configuration.AidingConfigurations.Count &gt; 0)\n{\nConsole.WriteLine(\"\\ne.g. GNSS aiding state: \" + getStateReply.Configuration.AidingConfigurations[0].EnableGnss);\n}\n\n// Create a device configuration. This contains configurations for Reset, Aiding, Sound Velocity, and DVL\nvar config = new Configuration();\n\n// Each type of config is stored as a list. This is reserved for future use as not all units support multiple configurations.\n\n// Create and add a reset config to perform a soft reset\nvar resetConfig = new ResetConfiguration();\nresetConfig.ResetType = ResetConfiguration.Types.RESET_TYPE.SoftReset;\nconfig.ResetConfigurations.Add(resetConfig);\n\n// Create and add an aiding config to enable GNSS aiding and disable USBL aiding\nvar aidingConfig = new AidingConfiguration();\naidingConfig.EnableGnss = AidingConfiguration.Types.AIDING_STATE.Enabled;\naidingConfig.EnableUsbl = AidingConfiguration.Types.AIDING_STATE.Disabled;\nconfig.AidingConfigurations.Add(aidingConfig);\n\n// Create and add a sound velocity config to set the SV source to salinity-derived and set the SV salinity to an arbitrary value\nvar svConfig = new SoundVelocityConfiguration();\nsvConfig.SoundVelocityType = SoundVelocityConfiguration.Types.SOUND_VELOCITY.InternalSalinity;\nsvConfig.ManualSalinityValue = 32.1;\nconfig.SoundVelocityConfigurations.Add(svConfig);\n\n// Create and add a DVL config to set the update rate to an arbitrary choice\nvar dvlConfig = new DopplerVelocityLogConfiguration();\ndvlConfig.UpdateRate = DopplerVelocityLogConfiguration.Types.UPDATE_RATE.Fixed1Hz;\nconfig.DopplerVelocityConfigurations.Add(dvlConfig);\n\n// Create the envelope containing the new config.\n//  Envelopes also contain 'timestamp' and 'result' fields which are populated in the instrument reply.\nvar configEnvelope = new ConfigurationEnvelope();\nconfigEnvelope.Configuration = config;\nConsole.WriteLine($\"\\nCreated an example ConfigurationEnvelope:\\n{configEnvelope}\\nSending now...\");\n\n// Perform the SetState with the new envelope\nvar replyEnvelope = client.SetState(configEnvelope);\n\n// Returned envelope contains the current state of the updated settings, as well as a result field\nConsole.WriteLine($\"\\nReceived ConfigurationEnvelope reply:\\n{replyEnvelope}\");\n</code></pre>"},{"location":"quick-start/#c-example_1","title":"C++ Example","text":"<p>As C++ has no universally accepted standard for managing project dependencies, gRPC supports several methods. The supplied C++ example code makes use of cmake, using <code>find_package</code>. This can only find software installed on your system, so gRPC will need to be installed from source using cmake. The installation location will then be referenced in cmake options to allow <code>find_package</code> to work.</p> <p>The .proto files can be built automatically using a custom command in cmake, as per the example code below. Alternatively, the source/header files can be generated from the .proto files manually with the following command:</p> <p><code>protoc --cpp_out=./proto-cpp-out/ --grpc_out=./proto-cpp-out/ --proto_path=protos/ protos/*.proto</code></p> <ul> <li><code>--cpp_out</code> specifies where to put the generated proto source/header files</li> <li><code>--grpc_out</code> specifies where to put the generated grpc source/header files</li> <li><code>--proto_path</code> specifies where the .proto files are located (used when proto files reference each other)</li> <li>The final parameter specifies the .proto file(s) to be compiled.</li> </ul> <p>protoc may require an extra parameter to specify the location of the gRPC C++ plugin, for example under Linux this could be: <code>--plugin=protoc-gen-grpc='which grpc_cpp_plugin'</code></p> <p>The example client code below made use of this guide.</p> Example C++ code example_code/cpp/CMakeLists.txt<pre><code>#Copyright 2023 Sonardyne\n\n#Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n#documentation files (the \u201cSoftware\u201d), to deal in the Software without restriction, including without limitation the\n#rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n#permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n#The above copyright notice and this permission notice shall be included in all copies or substantial portions of the\n#Software.\n\n#THE SOFTWARE IS PROVIDED \u201cAS IS\u201d, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\n#WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n#COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n#OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\ncmake_minimum_required(VERSION 3.26)\nproject(grpc_proto_example_cpp)\n\nset(CMAKE_CXX_STANDARD 17)\n\nfind_package(Protobuf CONFIG REQUIRED)\nmessage(\"Protobuf v\" ${Protobuf_VERSION})\n\nif(CMAKE_CROSSCOMPILING)\nfind_program(_PROTOBUF_PROTOC protoc)\nelse()\nset(_PROTOBUF_PROTOC $&lt;TARGET_FILE:protobuf::protoc&gt;)\nendif()\n\nfind_package(gRPC CONFIG REQUIRED)\nmessage(\"gRPC v\" ${gRPC_VERSION})\n\nif(CMAKE_CROSSCOMPILING)\nfind_program(_GRPC_CPP_PLUGIN_EXECUTABLE grpc_cpp_plugin)\nelse()\nset(_GRPC_CPP_PLUGIN_EXECUTABLE $&lt;TARGET_FILE:gRPC::grpc_cpp_plugin&gt;)\nendif()\n\nadd_subdirectory(src)\n</code></pre> example_code/cpp/src/CMakeLists.txt<pre><code>#Copyright 2023 Sonardyne\n\n#Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n#documentation files (the \u201cSoftware\u201d), to deal in the Software without restriction, including without limitation the\n#rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n#permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n#The above copyright notice and this permission notice shall be included in all copies or substantial portions of the\n#Software.\n\n#THE SOFTWARE IS PROVIDED \u201cAS IS\u201d, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\n#WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n#COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n#OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n# Compile the .proto files\nforeach(_proto configuration result service timestamp uid version)\nget_filename_component(${_proto}_proto \"../protos/${_proto}.proto\" ABSOLUTE)\nget_filename_component(${_proto}_proto_path \"${${_proto}_proto}\" PATH)\n\nset(${_proto}_proto_sources \"${CMAKE_CURRENT_BINARY_DIR}/${_proto}.pb.cc\")\nset(${_proto}_proto_headers \"${CMAKE_CURRENT_BINARY_DIR}/${_proto}.pb.h\")\nset(${_proto}_grpc_sources \"${CMAKE_CURRENT_BINARY_DIR}/${_proto}.grpc.pb.cc\")\nset(${_proto}_grpc_headers \"${CMAKE_CURRENT_BINARY_DIR}/${_proto}.grpc.pb.h\")\n\nadd_custom_command(\nOUTPUT \"${${_proto}_proto_sources}\" \"${${_proto}_proto_headers}\" \"${${_proto}_grpc_sources}\" \"${${_proto}_grpc_headers}\"\nCOMMAND ${_PROTOBUF_PROTOC}\nARGS --grpc_out \"${CMAKE_CURRENT_BINARY_DIR}\" --cpp_out \"${CMAKE_CURRENT_BINARY_DIR}\"\n-I \"${${_proto}_proto_path}\"\n--plugin=protoc-gen-grpc=\"${_GRPC_CPP_PLUGIN_EXECUTABLE}\"\n\"${${_proto}_proto}\"\nDEPENDS \"${${_proto}_proto}\")\nendforeach()\n\ninclude_directories(${CMAKE_CURRENT_BINARY_DIR})\n\nadd_library(son_grpc_proto\n${configuration_proto_sources}\n${configuration_proto_headers}\n${configuration_grpc_sources}\n${configuration_grpc_headers}\n${result_proto_sources}\n${result_proto_headers}\n${result_grpc_sources}\n${result_grpc_headers}\n${service_proto_sources}\n${service_proto_headers}\n${service_grpc_sources}\n${service_grpc_headers}\n${timestamp_proto_sources}\n${timestamp_proto_headers}\n${timestamp_grpc_sources}\n${timestamp_grpc_headers}\n${uid_proto_sources}\n${uid_proto_headers}\n${uid_grpc_sources}\n${uid_grpc_headers}\n${version_proto_sources}\n${version_proto_headers}\n${version_grpc_sources}\n${version_grpc_headers})\ntarget_link_libraries(son_grpc_proto\ngRPC::grpc++)\n\nadd_executable(son_grpc_client\nmain.cpp)\ntarget_link_libraries(son_grpc_client\nson_grpc_proto\ngRPC::grpc++)\n</code></pre> example_code/cpp/src/main.cpp<pre><code>//Copyright 2023 Sonardyne\n\n//Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//documentation files (the \u201cSoftware\u201d), to deal in the Software without restriction, including without limitation the\n//rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n//permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n//The above copyright notice and this permission notice shall be included in all copies or substantial portions of the\n//Software.\n\n//THE SOFTWARE IS PROVIDED \u201cAS IS\u201d, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\n//WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n//COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n//OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n#include &lt;iostream&gt;\n\n#include &lt;grpc/grpc.h&gt;\n#include &lt;grpcpp/channel.h&gt;\n#include &lt;grpcpp/client_context.h&gt;\n#include &lt;grpcpp/create_channel.h&gt;\n#include &lt;grpcpp/security/credentials.h&gt;\n\n#include \"service.pb.h\"\n#include \"service.grpc.pb.h\"\n\nclass SonGrpcClient {\npublic:\nSonGrpcClient(std::string target_ipport) :\n_channel(grpc::CreateChannel(target_ipport, grpc::InsecureChannelCredentials())),\n_stub(sonardyne::api::SonardyneService::NewStub(_channel)) {\n\n}\n\nvoid PrintVersion() {\nstd::cout &lt;&lt; \"Calling GetVersion...\" &lt;&lt; std::endl;\n\nsonardyne::api::VersionRequest version_request;\nsonardyne::api::VersionResponse version_response;\ngrpc::ClientContext client_context;\ngrpc::Status get_version_status = _stub-&gt;GetVersion(&amp;client_context, version_request, &amp;version_response);\nif (get_version_status.ok()) {\nstd::cout &lt;&lt; \"Called GetVersion: V\" &lt;&lt; version_response.major() &lt;&lt; \".\" &lt;&lt; version_response.minor() &lt;&lt; std::endl;\n}\nelse {\nstd::cout &lt;&lt; \"GetVersion failed.\" &lt;&lt; std::endl;\n}\n}\n\nvoid PrintAidingStates() {\nsonardyne::api::ConfigurationRequest config_request;\nconfig_request.set_requestor(_requestor_name);\nsonardyne::api::ConfigurationEnvelope config_envelope;\ngrpc::ClientContext client_context;\nstd::cout &lt;&lt; \"Calling GetState...\" &lt;&lt; std::endl;\ngrpc::Status get_state_status = _stub-&gt;GetState(&amp;client_context, config_request, &amp;config_envelope);\nif (get_state_status.ok()) {\nsonardyne::api::AidingConfiguration_AIDING_STATE gnss_state = config_envelope.configuration().aiding_configurations()[0].enable_gnss();\nsonardyne::api::AidingConfiguration_AIDING_STATE xpos_state = config_envelope.configuration().aiding_configurations()[0].enable_xpos();\nsonardyne::api::AidingConfiguration_AIDING_STATE usbl_state = config_envelope.configuration().aiding_configurations()[0].enable_usbl();\n\nstd::cout &lt;&lt; \"Called GetState:\" &lt;&lt; std::endl;\nPrintAnAidingState(\"GNSS\", gnss_state);\nPrintAnAidingState(\"XPOS\", xpos_state);\nPrintAnAidingState(\"USBL\", usbl_state);\n}\nelse {\nstd::cout &lt;&lt; \"GetState Failed.\" &lt;&lt; std::endl;\n}\n}\n\ngrpc::Status SetState(sonardyne::api::ConfigurationEnvelope request_config_envelope) {\nsonardyne::api::ConfigurationEnvelope response_config_envelope;\ngrpc::ClientContext client_context;\nstd::cout &lt;&lt; \"Calling SetState...\" &lt;&lt; std::endl;\nreturn _stub-&gt;SetState(&amp;client_context, request_config_envelope, &amp;response_config_envelope);\n}\n\nprivate:\nstd::shared_ptr&lt;grpc::Channel&gt; _channel;\nstd::unique_ptr&lt;sonardyne::api::SonardyneService::Stub&gt; _stub;\nstd::string _requestor_name = \"C++ Client\";\n\nvoid PrintAnAidingState(std::string aiding_source, sonardyne::api::AidingConfiguration_AIDING_STATE aiding_state) {\nif (aiding_state == sonardyne::api::AidingConfiguration_AIDING_STATE_ENABLED) {\nstd::cout &lt;&lt; aiding_source &lt;&lt; \" Aiding is enabled.\" &lt;&lt; std::endl;\n}\nelse if (aiding_state == sonardyne::api::AidingConfiguration_AIDING_STATE_DISABLED) {\nstd::cout &lt;&lt; aiding_source &lt;&lt; \" Aiding is disabled.\" &lt;&lt; std::endl;\n}\nelse {\nstd::cout &lt;&lt; aiding_source &lt;&lt; \" Aiding state unknown.\" &lt;&lt; std::endl;\n}\n}\n};\n\nint main (int argc, char *argv[]) {\nSonGrpcClient client(\"127.0.0.1:1234\"); // NOTE: Change the IP Address and Port to match the Instrument and its gRPC configuration.\nclient.PrintVersion();\nclient.PrintAidingStates();\n\nsonardyne::api::ConfigurationEnvelope request_config_envelope;\nsonardyne::api::AidingConfiguration *aiding_config = request_config_envelope.mutable_configuration()-&gt;add_aiding_configurations();\naiding_config-&gt;set_enable_gnss(sonardyne::api::AidingConfiguration_AIDING_STATE_ENABLED);\naiding_config-&gt;set_enable_xpos(sonardyne::api::AidingConfiguration_AIDING_STATE_ENABLED);\naiding_config-&gt;set_enable_usbl(sonardyne::api::AidingConfiguration_AIDING_STATE_ENABLED);\n\ngrpc::Status setstate_status = client.SetState(request_config_envelope);\n\nclient.PrintAidingStates();\n\nreturn 0;\n}\n</code></pre>"},{"location":"reference/","title":"Reference","text":""},{"location":"reference/#hnav","title":"HNAV","text":"<p>The Hybrid Navigation (HNAV) message includes all information required for vehicle guidance, control and navigation. All fields will be initialised to 0, once a field has been assigned a value it will retain that value until a further update is available. The status bits should be used to determine when data is old/stale. The HNAV requires the Simple binary protocol to successfully decode the message, see appendix G3 Simple Binary Protocol.  All data is transmitted LSB first.</p> <p>A C++ HNAV Decoder is available on Sonardyne's Github</p>"},{"location":"reference/#simple-binary-protocol","title":"Simple Binary Protocol","text":"Data Field LSB/(FixedValue) Range Data Type Size(Bytes) Notes Header (0xAA 0xBF) 0 to 255 UINT8 2 Header to denote the start of the packet Version (0) 0 to 255 UINT8 1 Version of protocol ID (0) 0 to 65535 UINT16 2 Message ID (HNAV = 0) see Note 1 Size - 0 - 4096 - 2 Size of data field in bytes, see note 2 Counter - 0 to 255 - 1 Counter per message, increments before rolling over to 0. Allows detection of out of order receipt. Spare - - - 2 Not Used Payload - - - - Message data (e.g. HNAV) Checksum - - UINT16 2 CRC-X.25: 0x1021. Covers all bytes before and including data bytes. Notes <p>Each Output message has its own Message ID, the message ID of HNAV is 0</p> <p>Each Output message will have a fixed size, the HNAV is 55 Bytes</p>"},{"location":"reference/#hnav-definition","title":"HNAV Definition","text":"Data Field LSB/(FixedValue) Range Data Type Size(Bytes) Notes Version 0 0 to 255 UINT8 1 Version of message Time of Validity (UTC) 10-6 seconds - UINT64 8 Latitude 2-31\u00d790 deg +/- 90 deg INT32 4 Not populated in Guidance Longitude 2-31\u00d7180 deg +/- 180 deg INT32 4 Not populated in Guidance Depth 1mm +/- 12,000m INT32 4 Depth at vehicle CRP Altitude 0.01m 0 to 600m UINT16 2 Altitude is referenced from SPRINT-Nav Mini\u2019s measurement point to the seabed (not compensated for CRP measurements). Roll 0.0055 deg +/- 180 deg INT16 2 Pitch 0.0055 deg +/- 90 deg INT16 2 Heading 0.0055 deg 0 to 360 deg UINT16 2 Fwd Velocity 1mm/s +/-30m/s INT16 2 Stbd Velocity 1mm/s +/-30m/s INT16 2 Dwn Velocity 1mm/s +/-30m/s INT16 2 Fwd Ang Rate 0.011 deg/s +/-300deg/s INT16 2 Stbd Ang Rate 0.011 deg/s +/-300deg/s INT16 2 Dwn Ang Rate 0.011 deg/s +/-300deg/s INT16 2 Sound Velocity 0.03m/s 1375 to 1900 m/s UINT16 2 Temperature 0.01\u00b0C +/- 100\u00b0C INT16 2 Position Quality - - FLOAT32 4 Not populated in Guidance 2D Quality (CEP50) Heading Quality 0.005\u00b0 0 to 180 deg UINT16 2 Velocity Quality 1mm/s 0 to 30 m/s UINT16 2 2D Quality Status - - - - See Status table"},{"location":"reference/#hnav-bit-fields","title":"HNAV Bit Fields","text":"Status Bit Field name Notes/Bit Set 0 System Error No error reported by system = 0 System Error reported = 1 1 Mode Alignment mode = 0 Hybrid mode = 1 2 Heading valid = 0 Invalid = 1 3 Altitude valid = 0 Invalid = 1 4 Velocity valid = 0 Invalid = 1 5 Depth valid = 0 Invalid = 1 6 Sound Velocity valid = 0 Invalid = 1 7 Temperature valid = 0 Invalid = 1 8 Spare Not Used 9 Position valid = 0 Invalid = 1 10 UTC Time valid = 0 Invalid = 1 11 Spare Not Used 12 Spare Not Used 13 Spare Not Used 14 Spare Not Used 15 Spare Not Used"},{"location":"technology-explainer/","title":"Technology Explainer","text":""},{"location":"technology-explainer/#grpc-and-protocol-buffers","title":"gRPC and Protocol Buffers","text":""},{"location":"technology-explainer/#what-is-grpc","title":"What is gRPC?","text":"<p>gRPC (a self-containing acronym: 'gRPC Remote Procedure Calls') is an open source universal RPC framework licensed under Apache 2.0. It allows clients and servers to be generated in a variety of supported languages and run on a variety of platforms. Complexity from communicating between different languages or platforms is handled for the developer by gRPC.</p>"},{"location":"technology-explainer/#what-are-protocol-buffers","title":"What are Protocol Buffers?","text":"<p>Protocol Buffers (or Protobuf) are a language-neutral, platform-neutral extensible mechanism for serialising structured data. They allow data to be stored in an efficient way when serialised, while still being easy to use for the programmer and allowing backwards-compatible updates to the interface. They are used by gRPC as the Interface Definition Language (IDL) and serialisation toolset.</p>"},{"location":"technology-explainer/#building-grpc-for-different-languages","title":"Building gRPC for different languages","text":"<p>gRPC + Protobuf can be used with a variety of platforms. In general, the steps are: - Install dependencies (protoc etc). - Use protoc to generate code from the .proto files. - Include the generated code in clients/servers.</p>"},{"location":"technology-explainer/#grpc-advantages-and-disadvantages","title":"gRPC advantages and disadvantages","text":"<ul> <li><code>+</code> gRPC is high-performance and produces compact binary messages. </li> <li><code>+</code> It can generate the necessary code for multiple platforms/languages.</li> <li><code>-</code> The binary format of Protobuf is not human-readable.</li> </ul>"},{"location":"technology-explainer/#json","title":"JSON","text":""},{"location":"technology-explainer/#what-is-the-json-interface","title":"What is the JSON interface?","text":"<p>The JSON interface is a layer in front of the gRPC interface, which allows a user to send a JSON string representation of the Protocol Buffer. The instrument will receive this string and convert it, using the same backend code as the gRPC interface (this ensures that both interfaces are guaranteed to behave in the same way).</p>"},{"location":"technology-explainer/#json-advantages-and-disadvantages","title":"JSON advantages and disadvantages","text":"<ul> <li><code>+</code> JSON is human-readable and may be a more user-friendly way of performing comms with the instrument.</li> <li><code>+</code> It can be used for sending commands by hand for testing, without use of extra software tools.</li> <li><code>-</code> Use of JSON strings will make messages larger, and will add a parsing overhead on the instrument.</li> </ul>"},{"location":"technology-explainer/#how-to-use-it","title":"How to use it","text":"<p>Configure the API using the instrument's webUI. Select JSON and select which port is to be used, then send a string representation of the Protocol Buffer to this port. Below is an example JSON string to perform a SetState command, which will perform the following:</p> <ul> <li>Enable GNSS, XPOS, and USBL as aiding sources</li> <li>Set sound velocity source to salinity-derived</li> <li>Set salinity to 39</li> <li>Set DVL update rate to 5Hz fixed</li> </ul> JSON string for SetState<pre><code>{\n\"configuration\": {\n\"aiding_configurations\": [\n{\n\"enable_gnss\": \"ENABLED\",\n\"enable_xpos\": \"ENABLED\",\n\"enable_usbl\": \"ENABLED\"\n}\n],\n\"sound_velocity_configurations\": [\n{\n\"sound_velocity_type\": \"INTERNAL_SALINITY\",\n\"manual_salinity_value\": 39\n},\n],\n\"doppler_velocity_configurations\": [\n{\n\"update_rate\": \"FIXED_5HZ\"\n}\n]\n}\n}\n</code></pre>"}]}